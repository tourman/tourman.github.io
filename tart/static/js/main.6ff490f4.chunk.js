(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(e,t,n){e.exports=n(25)},20:function(e,t,n){},25:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(10),u=n.n(i),c=(n(20),function(e){var t=window,n=t.scrollX,r=t.scrollY;e(),window.scrollTo(n,r)}),o=function(e){var t=a.a.Children.map(e.children,function(e){return a.a.cloneElement(e,{silentFocus:c,throttleDelay:200})});return a.a.createElement("div",null,t)},s=n(4),l=n(3),f=n(2),g=n.n(f),m=n(7),d=n(5),v=n(6),p=n(13),h=n(11),b=n(14),y=a.a.memo(function(e){var t={},n=e.size,r=2*n;t.left=e.x-n,t.top=e.y-n,t.width=r,t.height=r,t.lineHeight=r;var i=["linen__figure","figure","figure_type_".concat(e.type)].join(" "),u=!e.weightChanging,c={};return u&&(c={onDragStart:e.onMouse(e.onFigureMoveStart,e.index),onDragEnd:e.onMouse(e.onFigureMoveEnd,e.index)}),a.a.createElement("div",Object.assign({className:i,style:t,draggable:u},c),e.index)}),j=function(e,t){var n=e.totalWeight-t.totalWeight;return Math.abs(n)>=Number.EPSILON},O=n(1),w=(new Map).set(!0,"negative").set(!1,"positive"),E=function(e,t,n){return function(r){var a=e.current.getBoundingClientRect(),i=r.clientX-a.left,u=r.clientY-a.top,c=r.ctrlKey||r.shiftKey||2===r.button,o=w.get(c);t({x:i,y:u,type:o,index:n})}},x=a.a.memo(function(e){var t=Object(r.useRef)(null),n=E.bind(null,t),i=a.a.Children.map(e.children,function(e){return a.a.cloneElement(e,Object(s.a)({},e.props,{onMouse:n}))});return a.a.createElement("div",{className:"linen app__element",style:{width:e.size,height:e.size},ref:t,onMouseDown:function(n){n.target===t.current&&E(t,e.onFigureAdd)(n)},onMouseMove:n(e.onFigureLastResize),onMouseUp:n(e.onFigureLastUpdate)},i)},function(e,t){for(var n=["size","onFigureAdd","onFigureLastResize","onFigureLastUpdate"],r=0;r<n.length;r++){var a=n[r];if(e[a]!==t[a])return!1}return!0}),_=a.a.memo(function(e){var t=Object(O.pickBy)(e,function(e){return"function"===typeof e});return e.figures.map(function(e,n){var r=e.id,i=e.size,u=e.type,c=e.x,o=e.y;return a.a.createElement(y,Object.assign({},Object(s.a)({x:c,y:o,size:i,type:u,index:n},t),{key:r}))})},function(e,t){return e.move===t.move&&(e.figures.length===t.figures.length&&(!t.weightChanging&&!j(e,t)))}),k=function(e){function t(){return Object(d.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(b.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e=Object(s.a)({},this.props,this.state);return a.a.createElement(_,e)}}]),t}(a.a.Component),W=a.a.memo(function(e){var t=Object(r.useRef)(null);return Object(r.useEffect)(function(){t.current.setState(e)}),a.a.createElement(x,e,a.a.createElement(k,Object.assign({},e,{ref:t})))}),R=a.a.memo(function(e){var t=["app__element","info-total-bar","figure","figure_throttle","figure_type_".concat(e.type)].join(" "),n=e.percent.toFixed(1);return a.a.createElement("div",{className:t,style:{width:"".concat(e.width,"px")}},a.a.createElement("span",{className:"info-total-bar__label"},n,"%"))}),F=a.a.memo(function(e){return a.a.createElement(a.a.Fragment,null,Object.entries(e.typeRelativeWeights).map(function(t){var n=Object(l.a)(t,2),r=n[0],i=n[1],u={percent:100*i,width:i*e.size,type:r};return a.a.createElement(R,Object.assign({},u,{key:r}))}))},function(e,t){return!j(e,t)}),z=function(e){var t=a.a.forwardRef(e);return function(e){var n=Object(r.useRef)(null),i=Object(r.useRef)(null);return Object(r.useEffect)(function(){clearTimeout(i.current),document.activeElement!==n.current&&e.focus&&(i.current=setTimeout(function(){e.silentFocus(function(){return n.current&&n.current.focus()})},50))}),a.a.createElement(t,Object.assign({},e,{ref:n}))}}(function(e,t){return a.a.createElement("input",{className:"item__editor item__child",ref:t,value:e.name,onChange:function(t){t.preventDefault();var n=t.target.value,r=e.index;e.onChangeName({name:n,index:r})}})}),M=(new Map).set(!0,function(e){var t=e.onRemove,n=e.index;return a.a.createElement("button",{onClick:function(e){e.preventDefault(),t({index:n})}},"x")}).set(!1,function(e){return e.index}),C=function(e){return a.a.createElement("div",{className:"item app__element"},e.renderInteractiveName(e),e.renderControls(e),e.renderChart(e))},N={renderInteractiveName:z,renderControls:function(e){var t=Object(r.useState)(!1),n=Object(l.a)(t,2),i=n[0],u=n[1];return a.a.createElement("span",{className:"item__number item__child",onMouseEnter:function(e){u(!0)},onMouseLeave:function(e){u(!1)}},M.get(i)(e))},renderChart:function(e){var t=["item__bar","item__child","figure","figure_throttle","figure_type_".concat(e.type)].join(" "),n="".concat(220*e.relativeWeight,"px");return a.a.createElement("div",{className:t,style:{width:n}})}},S=a.a.memo(function(e){var t=Object(O.mapValues)(N,function(e){return function(t){return a.a.createElement(e,t)}});return a.a.createElement(C,Object.assign({},e,t))}),L=function(e){var t=Object(O.pickBy)(e,function(e){return"function"===typeof e});return a.a.createElement("div",{style:{width:"".concat(e.size,"px")}},e.figures.map(function(e,n){return a.a.createElement(S,Object.assign({key:e.id,index:n},e,t))}))},I=function(e){var t=(new Map).set(!1,e);return function(n){t.get(!0)||t.set(!0,Object(O.throttle)(e,n.throttleDelay));var r=t.get(n.weightChanging);return a.a.createElement(r,n)}}(function(e){return a.a.createElement(a.a.Fragment,null,a.a.createElement(F,e),a.a.createElement(L,e))}),B=function(){function e(){Object(d.a)(this,e)}return Object(v.a)(e,[{key:"getInitialState",value:function(){return{size:500,minRadius:5,totalWeight:0,figures:[],typeRelativeWeights:{positive:0,negative:0},weightChanging:!1}}},{key:"add",value:function(e,t){var n=t.x,r=t.y,a=t.type,i={id:Object(O.uniqueId)("item_"),x:n,y:r,size:0,weight:0,type:a,name:"",focus:!1};return e.figures.push(i),e=this.updateWeights(e)}},{key:"remove",value:function(e,t){var n=t.index;return e.figures.splice(n,1),e=this.updateWeights(e)}},{key:"updateLast",value:function(e,t){e.figures.forEach(function(e){return e.focus=!1});var n=Object(O.last)(e.figures);n.focus=!0;var r=this.getWeightAndSize(n,t);return Object.assign(n,r),e=this.updateWeights(e)}},{key:"changeName",value:function(e,t){var n=t.name,r=t.index;return e.figures[r].name=n,e}},{key:"getWeightAndSize",value:function(e,t){var n=t.x-e.x,r=t.y-e.y,a=n*n+r*r;return{weight:a,size:Math.sqrt(a)}}},{key:"updateWeights",value:function(e){var t=this.getWeights(e);return Object.assign(e,t),e.figures=e.figures.map(this.setRelativeWeight.bind(this,e)),e}},{key:"getWeights",value:function(e){var t=Object(O.groupBy)(e.figures,"type"),n=Object(O.mapValues)(t,function(e){return Object(O.sumBy)(e,"weight")}),r=Object(O.sum)(Object.values(n));return{typeRelativeWeights:Object(O.chain)(n).mapValues(function(e){return e/r}).mapValues(function(e){return e!==e?1:e}).value(),totalWeight:r}}},{key:"setRelativeWeight",value:function(e,t){return t.relativeWeight=t.weight/e.totalWeight,t.relativeWeight=t.relativeWeight!==t.relativeWeight?1:t.relativeWeight,t}}]),e}(),D=n(12),A=new B,T=A.getInitialState(),V=function(e,t){var n=t.type,r=t.payload;return Object(D.a)(e,function(e){switch(n){case"figure.add":A.add(e,r),e.openForResizing=!0;break;case"figure.last.resize":e.openForResizing&&(A.updateLast(e,r),e.weightChanging=!0);break;case"figure.last.update":e.openForResizing&&(A.updateLast(e,r),e.weightChanging=!1,e.openForResizing=!1);break;case"figure.name":A.changeName(e,r);break;case"figure.remove":A.remove(e,r);break;case"figure.move.start":break;case"figure.move.end":var t=r.index,a=r.x,i=r.y,u=e.figures[t];Object.assign(u,{x:a,y:i}),e.move={figure:u};break;case"read":Object.assign(e,r)}})},J={onFigureAdd:"figure.add",onFigureLastResize:"figure.last.resize",onFigureLastUpdate:"figure.last.update",onChangeName:"figure.name",onRemove:"figure.remove",onFigureMoveStart:"figure.move.start",onFigureMoveEnd:"figure.move.end",onRead:"read"},U=function(){var e=Object(m.a)(g.a.mark(function e(t){return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){setTimeout(function(){var n=localStorage.getItem("tart.state")||null,r=JSON.parse(n);e(r||t)})}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(m.a)(g.a.mark(function e(t){return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){setTimeout(function(){var n=JSON.stringify(t);localStorage.setItem("tart.state",n),e()})}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),q=new Map,K=function(e){var t=Object(r.useReducer)(V,T),n=Object(l.a)(t,2),i=n[0],u=n[1],c=q.get(u)||Object(O.mapValues)(J,function(e){return function(t){return u({type:e,payload:t})}});q.set(u,c);var o=Object(s.a)({},e,i,c);return Object(r.useEffect)(function(){i===T?Object(m.a)(g.a.mark(function e(){var t;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(i);case 2:return t=e.sent,c.onRead(t),e.abrupt("return",t);case 5:case"end":return e.stop()}},e)}))():P(i)}),a.a.createElement(a.a.Fragment,null,a.a.createElement(W,o),a.a.createElement(I,o))},X=function(e){return a.a.createElement(a.a.StrictMode,null,a.a.createElement(o,null,a.a.createElement(K,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(a.a.createElement(X,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[15,1,2]]]);
//# sourceMappingURL=main.6ff490f4.chunk.js.map